# SOC Automation lab with SOAR

 <p align="center">
Configuration Reference Diagram: <br/>
<img src="https://imgur.com/TT4mect.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
     
## Objectives
- Installation+Configuration of Wazuh & TheHive Servers on the Cloud
- Setting up a Windows 10 client on VirtualBox, installing Sysmon and Wazuh agent in that
- Generating Telemetry via Mimikatz & Ingesting Logs into Wazuh
- Integrateing Shuffle SOAR and employing VirusTotal
- Directing alerts to Shuffle and escalating it to TheHive for case management
- Mailing it to SOC analysts for the investigation then enabling proactive response by the Wazuh to secure Windows.

### Tools Used
- Digitalocean
- Wazuh
- TheHive
- Shuffle
- VirtualBox
- Windows
- Ubuntu
- Sysmon
- Mimikatz
- Virustotal
- Powershell


## Walkthrough

First, we are going to be dealing with a tool called Wazuh. Wazuh is a cybersecurity tool that integrates SIEM + XDR capabilities. Comes with a load of features like Log Data analysis, Incident Response, Intrusion Detection and many more!

Second, we are also going to be using the The Hive in which it’s a 4 in 1 Incident Response tool. We will be using it as our case management tool!

Third, we will have a Windows 10 virtual machine with Sysmon installed.

Sysmon is a valuable tool for enhancing the security posture of Windows-based systems by providing detailed monitoring and logging capabilities essential for Incident Response and more. It will make logging data into Wazuh so much easier once we have our indexer agent installed. It will forward the events generated by Sysmon directly into Wazuh making the data easily visible to analyze.

First, we are going to begin by Installing VirtualBox and Installing Windows 10 into it. Next, we are going to download Sysmon straight from Microsoft’s website. Once, that’s done we are going to begin installing Sysmon .XML file. Once both are finished downloading we extract the zipped Sysmon file right in the Downloads directory. We are going to copy the file path for our next step.

From there we shall open Powershell with administrative privileges. We are then going to go over to run the following commands shown below:

<br/>
<img src= "https://imgur.com/ZcFV1AS.png" height="80%" width="80%" alt=""/>
<br />
<br />

We are going to check our directory to make sure Sysmon executable and the configuration file is in there. Next, we are going to run the executable and we see that it doesn’t run but shows us the help command to guide us how to go about using Sysmon, confirming we don’t have Sysmon installed.

./sysmon64.exe -i sysmonconfig.xml

We may double check by running ‘Services & Event Viewer’.

Click and type ‘S’ scroll down until we see Sysmon
Application and Services>Microsoft>Windows>Click and type ‘S’
Once, we see it in there we are good to go! If, we click on Sysmon in Event Viewer and click on ‘Operational’. We see a ton of telemetry!

<br/>
<img src= "https://imgur.com/5aUgEZa.png" height="80%" width="80%" alt=""/>
<br />
<br />

Now that we have Windows 10 installed with Sysmon we can go ahead and detect malicious activity!

Next, we are going to install Wazuh via Digital ocean. Create a new droplet
We shall then proceed to select an Ubuntu image running on 22.04 LTS x64.
Requirements is at least 8GB ram and 50gb of Disk space 

<br/>
<img src= "https://imgur.com/i3WYCNQ.png" height="80%" width="80%" alt=""/>
<br />
<br />

Now, hover over to the “firewall” tab. Begin, creating our firewall.
Change our Inbound to “All TCP” ports and only specify our IP address to be able to access our droplet.
We can do a look up in our search engine, “What is my IP address”? It should provide it to you just copy and paste it into our firewall configuration.
We will want to do the same for UDP just in case. Scroll down and click on “Create Firewall.” Once our firewall is created we can start adding our virtual machine to it.

<br/>
<img src= "https://imgur.com/eFwFS4b.png" height="80%" width="80%" alt=""/>
<img src= "https://imgur.com/YUXCcmg.png" height="80%" width="80%" alt=""/>
<br />
<br />

On the left hand side, Click on Droplets and Click on our newly created Wazuh droplet.
Inside the droplet let’s click on Networking. Scroll down until you see Firewalls.
Click “Edit” It will show the newly created firewall we just created click on it. Scroll over to our droplet tab and click “Add Droplets.”

<br/>
<img src= "https://imgur.com/DlpxGH9.png" height="80%" width="80%" alt=""/>
<br />
<br />











<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
# Automation-Lab-with-SOAR
